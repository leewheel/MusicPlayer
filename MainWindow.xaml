<Window x:Class="TikTokMusicPlayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TikTok Music Player"
        Width="360" Height="640"
        MinWidth="360" MinHeight="640"
        Background="Transparent"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        WindowStyle="None"
        AllowsTransparency="True"
        KeyDown="Window_KeyDown">

    <Window.Resources>
        <Style x:Key="SciFiButton" TargetType="Button">
            <Setter Property="Background" Value="#0F1428"/>
            <Setter Property="Foreground" Value="#00FFFF"/>
            <Setter Property="BorderBrush" Value="#00FFFF"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="3">
                            <Border.Effect>
                                <DropShadowEffect Color="#00FFFF" BlurRadius="8" ShadowDepth="0" Opacity="0.5"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1A2040"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#00B4DC"/>
                                <Setter Property="Foreground" Value="#FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#00FFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Background="Transparent">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#C77DFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FF6B6B"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="25"/>
            <Setter Property="Height" Value="25"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid Background="Transparent">
                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"
                                  Fill="{TemplateBinding Foreground}"
                                  Stretch="Uniform"
                                  Width="14" Height="14"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#FF0000"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SciFiSlider" TargetType="Slider">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#00FFFF"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <Border x:Name="TrackBackground"
                                    Height="4"
                                    CornerRadius="2"
                                    Background="#1A2040"
                                    Margin="0,2,0,2">
                                <Border.Effect>
                                    <DropShadowEffect Color="#00FFFF" BlurRadius="3" ShadowDepth="0" Opacity="0.3"/>
                                </Border.Effect>
                            </Border>
                            
                            <Border x:Name="TrackFill"
                                    Height="4"
                                    CornerRadius="2"
                                    Background="#00FFFF"
                                    HorizontalAlignment="Left"
                                    Margin="0,2,0,2">
                                <Border.Effect>
                                    <DropShadowEffect Color="#00FFFF" BlurRadius="6" ShadowDepth="0" Opacity="0.8"/>
                                </Border.Effect>
                            </Border>
                            
                            <Canvas VerticalAlignment="Center">
                                <Ellipse x:Name="Thumb"
                                         Width="14" Height="14"
                                         Fill="#00FFFF"
                                         Stroke="#C77DFF"
                                         StrokeThickness="2"
                                         Canvas.Left="0"
                                         Canvas.Top="-7">
                                    <Ellipse.Effect>
                                        <DropShadowEffect Color="#00FFFF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                                    </Ellipse.Effect>
                                </Ellipse>
                            </Canvas>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border x:Name="WindowBorder"
            BorderBrush="#9D4EDD"
            BorderThickness="2"
            CornerRadius="10"
            Background="#0A0F23"
            MouseLeftButtonDown="WindowBorder_MouseLeftButtonDown">
        <Border.Effect>
            <DropShadowEffect x:Name="WindowShadow" Color="#9D4EDD" BlurRadius="20" ShadowDepth="0" Opacity="0.7"/>
        </Border.Effect>
        <Border.Triggers>
            <EventTrigger RoutedEvent="Loaded">
                <BeginStoryboard>
                    <Storyboard RepeatBehavior="Forever">
                        <ColorAnimation Storyboard.TargetName="WindowBorder"
                                      Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                      From="#9D4EDD" To="#C77DFF" Duration="0:0:3" AutoReverse="True"/>
                        <DoubleAnimation Storyboard.TargetName="WindowBorder"
                                    Storyboard.TargetProperty="(Border.Effect).(DropShadowEffect.BlurRadius)"
                                    From="15" To="30" Duration="0:0:3" AutoReverse="True"/>
                    </Storyboard>
                </BeginStoryboard>
            </EventTrigger>
        </Border.Triggers>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Canvas x:Name="StarfieldCanvas" Grid.RowSpan="3" Panel.ZIndex="-1" IsHitTestVisible="False"/>

            <Grid Grid.Row="0" Margin="10,10,10,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Style="{StaticResource IconButton}" Click="BtnSettings_Click"
                        ToolTip="设置 (Ctrl+Shift+F9)">
                    <Path Data="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.21,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.21,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.67 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"
                          Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                          Stretch="Uniform"
                          Width="18" Height="18"/>
                </Button>

                <Button Grid.Column="1" Style="{StaticResource IconButton}" Click="BtnOpenFile_Click"
                        ToolTip="选择音乐文件" Margin="5,0,0,0">
                    <Path Data="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z"
                          Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                          Stretch="Uniform"
                          Width="18" Height="18"/>
                </Button>

                <Button Grid.Column="1" x:Name="BtnAISongs" Style="{StaticResource IconButton}" 
                        Click="BtnAISongs_Click"
                        ToolTip="播放AI翻唱歌曲" Margin="55,0,0,0">
                    <Path Data="M12,3V13.55C11.41,13.21 10.73,13 10,13A4,4 0 0,0 6,17A4,4 0 0,0 10,21A4,4 0 0,0 14,17V7H18V3H12Z"
                          Fill="#C77DFF"
                          Stretch="Uniform"
                          Width="18" Height="18"/>
                </Button>

                <TextBlock x:Name="SongTitleText"
                          Grid.Column="2"
                          Text="未选择歌曲"
                          Foreground="#00FFFF"
                          FontSize="14"
                          FontWeight="Bold"
                          TextAlignment="Center"
                          VerticalAlignment="Center"
                          TextTrimming="CharacterEllipsis"
                          Margin="10,0">
                    <TextBlock.Effect>
                        <DropShadowEffect Color="#00FFFF" BlurRadius="10" ShadowDepth="0" Opacity="0.6"/>
                    </TextBlock.Effect>
                </TextBlock>

                <Button Grid.Column="3" Style="{StaticResource IconButton}" Click="BtnMinimize_Click"
                        ToolTip="最小化" Margin="0,0,5,0">
                    <Path Data="M19,13H5V11H19V13Z"
                          Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}"
                          Stretch="Uniform"
                          Width="14" Height="14"/>
                </Button>

                <Button Grid.Column="4" Style="{StaticResource CloseButton}" Click="BtnClose_Click"
                        ToolTip="关闭"/>
            </Grid>

            <Grid Grid.Row="1" Margin="15,5,15,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Border x:Name="AlbumCoverBorder" Grid.Row="0"
                        CornerRadius="10"
                        BorderBrush="#00FFFF"
                        BorderThickness="3"
                        Background="#0F1428">
                    <Border.Effect>
                        <DropShadowEffect Color="#00FFFF" BlurRadius="15" ShadowDepth="0" Opacity="0.5"/>
                    </Border.Effect>
                    <Border CornerRadius="7" ClipToBounds="True" Background="#0F1428" Margin="2">
                        <Image x:Name="AlbumCoverImage"
                               Stretch="UniformToFill"
                               RenderOptions.BitmapScalingMode="Fant"/>
                    </Border>
                </Border>

                <Border Grid.Row="1"
                        Background="#800A0F23"
                        CornerRadius="5"
                        Margin="0,8,0,0"
                        Padding="10,8">
                    <ScrollViewer x:Name="LyricsScrollViewer"
                                 Height="65"
                                 VerticalScrollBarVisibility="Hidden"
                                 HorizontalScrollBarVisibility="Hidden">
                        <TextBlock x:Name="LyricsText"
                                  Text=""
                                  Foreground="#C77DFF"
                                  FontSize="12"
                                  TextAlignment="Center"
                                  TextWrapping="Wrap"
                                  LineHeight="18">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="#C77DFF" BlurRadius="5" ShadowDepth="0" Opacity="0.5"/>
                            </TextBlock.Effect>
                        </TextBlock>
                    </ScrollViewer>
                </Border>
            </Grid>

            <Grid Grid.Row="2" Margin="0,0,0,10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <Grid Grid.Row="0" Margin="20,10" x:Name="ProgressGrid"
                      MouseLeftButtonDown="ProgressSlider_PreviewMouseDown"
                      MouseLeftButtonUp="ProgressSlider_PreviewMouseUp"
                      MouseMove="ProgressSlider_MouseMove"
                      LostMouseCapture="ProgressGrid_LostMouseCapture">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBlock Grid.Column="0" x:Name="CurrentTimeText" Text="00:00" 
                              Foreground="#00FFFF" FontSize="11" VerticalAlignment="Center"
                              Margin="0,0,10,0">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#00FFFF" BlurRadius="5" ShadowDepth="0" Opacity="0.5"/>
                        </TextBlock.Effect>
                    </TextBlock>
                    
                    <Grid Grid.Column="1" x:Name="ProgressTrack" Height="20" Cursor="Hand">
                        <Border Height="6" CornerRadius="3" Background="#1A2040" VerticalAlignment="Center">
                            <Border.Effect>
                                <DropShadowEffect Color="#00FFFF" BlurRadius="3" ShadowDepth="0" Opacity="0.3"/>
                            </Border.Effect>
                        </Border>
                        <Border x:Name="ProgressFill"
                                Height="6" CornerRadius="3"
                                Background="#00FFFF"
                                HorizontalAlignment="Left" Width="0"
                                VerticalAlignment="Center">
                            <Border.Effect>
                                <DropShadowEffect Color="#00FFFF" BlurRadius="8" ShadowDepth="0" Opacity="0.8"/>
                            </Border.Effect>
                        </Border>
                        <Ellipse x:Name="ProgressThumb"
                               Width="14" Height="14"
                               HorizontalAlignment="Left"
                               Margin="-7,0,0,0"
                               Fill="#00FFFF"
                               Stroke="#C77DFF"
                               StrokeThickness="2"
                               Visibility="Visible"
                               VerticalAlignment="Center">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="#00FFFF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                            </Ellipse.Effect>
                        </Ellipse>
                    </Grid>
                    
                    <TextBlock Grid.Column="2" x:Name="TotalTimeText" Text="00:00" 
                              Foreground="#00FFFF" FontSize="11" VerticalAlignment="Center"
                              Margin="10,0,0,0">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="#00FFFF" BlurRadius="5" ShadowDepth="0" Opacity="0.5"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </Grid>

                <Canvas x:Name="SpectrumCanvas"
                       Grid.Row="1"
                       Height="80"
                       Margin="10,5"
                       IsHitTestVisible="False"/>

                <Grid Grid.Row="2">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <Button x:Name="BtnPrev" Content="⏮" Style="{StaticResource SciFiButton}" Width="40" Height="30"
                               Margin="5,0" Click="BtnPrev_Click" FontSize="14"/>
                        <Button x:Name="BtnPlayPause" Content="▶" Style="{StaticResource SciFiButton}" Width="50" Height="35"
                               Margin="5,0" Click="BtnPlayPause_Click" FontSize="16"/>
                        <Button x:Name="BtnNext" Content="⏭" Style="{StaticResource SciFiButton}" Width="40" Height="30"
                               Margin="5,0" Click="BtnNext_Click" FontSize="14"/>
                    </StackPanel>
                    
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button x:Name="BtnSelectLyric" 
                                Width="30" Height="30"
                                Margin="0,0,5,0"
                                Click="BtnSelectLyric_Click"
                                ToolTip="选择歌词"
                                Visibility="Collapsed">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="#0F1428" BorderBrush="#C77DFF" BorderThickness="1" CornerRadius="5">
                                        <Path Data="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M9.54,15.65L11.63,17.74L10.35,19L7,15.65L10.35,12.3L11.63,13.56L9.54,15.65M17,15.65L13.65,19L12.38,17.74L14.47,15.65L12.38,13.56L13.65,12.3L17,15.65Z"
                                              Fill="#C77DFF" Stretch="Uniform" Width="16" Height="16"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                        <Button x:Name="BtnPlaylist" 
                                Width="30" Height="30"
                                Margin="0,0,5,0"
                                Click="BtnPlaylist_Click"
                                ToolTip="播放列表"
                                Visibility="Collapsed">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="#0F1428" BorderBrush="#00FFFF" BorderThickness="1" CornerRadius="5">
                                        <Path Data="M18,2A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2H18M18,4H6V20H18V4M10,6H14V8H10V6M10,10H14V12H10V10M10,14H14V16H10V14M8,6V8H9V6H8M8,10V12H9V10H8M8,14V16H9V14H8Z"
                                              Fill="#00FFFF" Stretch="Uniform" Width="16" Height="16"/>
                                    </Border>
                                </ControlTemplate>
                            </Button.Template>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>
